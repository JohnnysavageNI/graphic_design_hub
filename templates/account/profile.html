{% extends "base.html" %}
{% block content %}
<div class="container" style="padding-top:6rem; max-width:900px;">
  <h1 class="text-white mb-4">My Profile</h1>

  <div class="card mb-4">
    <div class="card-header"><strong>Live Orders (Pending / In Progress)</strong></div>
    <ul class="list-group list-group-flush">
      {% if in_progress %}
        {% for r in in_progress %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <div><strong>#{{ r.id }}</strong> — {{ r.service.name }}</div>
              <div class="small text-muted">Status: {{ r.get_status_display }}</div>
              {% if r.instructions %}<div class="small">{{ r.instructions|linebreaksbr }}</div>{% endif %}
            </div>
            {% if r.uploads.count %}
              <span class="badge badge-secondary">{{ r.uploads.count }} file(s)</span>
            {% endif %}
          </li>
        {% endfor %}
      {% else %}
        <li class="list-group-item">No live orders.</li>
      {% endif %}
    </ul>
  </div>

  <div class="card">
    <div class="card-header"><strong>Completed Orders</strong></div>
    <ul class="list-group list-group-flush">
      {% if completed %}
        {% for r in completed %}
          <li class="list-group-item">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <div><strong>#{{ r.id }}</strong> — {{ r.service.name }}</div>
                {% if r.instructions %}<div class="small text-muted">{{ r.instructions|truncatechars:140 }}</div>{% endif %}
              </div>
              <span class="badge badge-success">Completed</span>
            </div>
            {% if r.uploads.count %}
              <div class="mt-2">
                {% for up in r.uploads.all %}
                  <a class="btn btn-sm btn-outline-primary mr-2 mb-2"
                     href="{% url 'orders:download_upload' up.id %}">
                    Download file {{ forloop.counter }}
                  </a>
                {% endfor %}
              </div>
            {% else %}
              <div class="small text-muted mt-2">No deliverables uploaded yet.</div>
            {% endif %}
          </li>
        {% endfor %}
      {% else %}
        <li class="list-group-item">No completed orders yet.</li>
      {% endif %}
    </ul>
  </div>
</div>
{% endblock %}